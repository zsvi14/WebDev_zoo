<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../CSS_JS/style_siham.css">
    <title>Liste des Enclos</title>
</head>
<header>
    <button class="home-button" onclick="window.location.href='../connexion/home.html';">Retour Ã  l'accueil</button>
    <h1 class="park-name">ğŸ¦’ğŸ˜ğŸ¦“Le rrrh parcğŸ¦ğŸ¦“ğŸ¦’</h1>
</header>

<body>
    <h1 id="title_enclos">Liste des Enclos</h1>

    <!-- Conteneur des enclos -->
    <div id="enclos-container">
        <!-- La liste des enclos sera affichÃ©e ici dynamiquement -->
    </div>

    <script>
        function afficherEnclos(data) {
            const container = document.getElementById('enclos-container');
            container.innerHTML = ''; // Vider le conteneur avant de le remplir

            if (!data || data.length === 0) {
                container.innerHTML = '<p>Aucun enclos trouvÃ©.</p>';
                return;
            }

            // Organiser les enclos pour que chaque enclos contienne la liste des animaux
            const enclosMap = {};
            data.forEach(item => {
                // Si l'enclos n'existe pas encore dans le tableau enclosMap, on l'ajoute
                if (!enclosMap[item.id]) {
                    enclosMap[item.id] = {
                        nom: item.nom_enclos,
                        biome: item.biome,
                        animaux: []
                    };
                }
                // Ajouter l'animal Ã  la liste des animaux pour cet enclos
                enclosMap[item.id].animaux.push(item.animal);
            });

            // Affichage des enclos
            Object.keys(enclosMap).forEach(id => {
                const enclos = enclosMap[id];
                const enclosDiv = document.createElement('div');
                enclosDiv.classList.add('enclos');

                // Lien vers les dÃ©tails de l'enclos
                const enclosLink = document.createElement('a');
                enclosLink.href = `details_enclos.php?id=${id}`;
                enclosLink.textContent = `${enclos.nom} (Biome : ${enclos.biome})`;
                enclosLink.classList.add('enclos-link');
                enclosDiv.appendChild(enclosLink);

                // Liste des animaux dans cet enclos
                if (enclos.animaux.length > 0) {
                    const animauxList = document.createElement('ul');
                    enclos.animaux.forEach(animal => {
                        const animalItem = document.createElement('li');
                        animalItem.textContent = animal;
                        animauxList.appendChild(animalItem);
                    });
                    enclosDiv.appendChild(animauxList);
                } else {
                    const noAnimalText = document.createElement('p');
                    noAnimalText.textContent = 'Aucun animal dans cet enclos.';
                    enclosDiv.appendChild(noAnimalText);
                }

                // Ajouter l'enclos dans le conteneur
                container.appendChild(enclosDiv);
            });
        }

        function fetchEnclos() {
            fetch('http://localhost/WebDev_zoo/back/routes/enclos.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur HTTP : ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('DonnÃ©es rÃ©cupÃ©rÃ©es :', data);
                    afficherEnclos(data);
                })
                .catch(error => {
                    console.error('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es :', error);
                    const container = document.getElementById('enclos-container');
                    container.innerHTML = '<p>Erreur lors du chargement des enclos.</p>';
                });
        }

        window.onload = fetchEnclos;
    </script>

</body>
</html>
